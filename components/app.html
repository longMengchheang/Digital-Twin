<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Twin</title>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="./ui/checkin.css">
  <link rel="stylesheet" href="./ui/sidebar.css">
  <link rel="stylesheet" href="./ui/quest.css">
  <link rel="stylesheet" href="./ui/chat.css">
  <link rel="stylesheet" href="./ui/history.css">
  <link rel="stylesheet" href="./ui/profile.css">
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <h1>Digital Twin</h1>
    </div>

    <!-- Navigation Menu -->
    <nav class="nav-menu">
      <button class="nav-button active" onclick="showSection('checkin')">
        <i class="icon" data-lucide="home" style="color: hsl(48 96% 50%);"></i>
        <span class="text">DAILY CHECK IN</span>
      </button>
      <button class="nav-button" onclick="showSection('quests')">
        <i class="icon" data-lucide="target" style="color: hsl(350, 100%, 70%);"></i>
        <span class="text">QUESTS</span>
      </button>
      <button class="nav-button" onclick="showSection('chat')">
        <i class="icon" data-lucide="message-circle" style="color: hsl(84 81% 44%);"></i>
        <span class="text">CHAT</span>
      </button>
      <button class="nav-button" onclick="showSection('history')">
        <i class="icon" data-lucide="history" style="color: hsl(210 40% 98%);"></i>
        <span class="text">HISTORY</span>
      </button>
      <button class="nav-button" onclick="showSection('profile')">
        <i class="icon" data-lucide="user" style="color: hsl(218 91% 60%);"></i>
        <span class="text">PROFILE</span>
      </button>
    </nav>
  </div>

  <!-- Main content area -->
  <div class="main-content">
    <!-- Daily Check-In Section -->
    <div id="checkin-section" class="section-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Daily Check-In</h2>
        </div>
        <div class="card-content">
          <div class="progress-indicator" id="progress-indicator">Question 1 of 5</div>
          <div class="question" id="daily-question">How are you feeling today?</div>
          <div class="stars-container" id="stars-container"></div>
          <div class="rating-labels">
            <span>Awful</span>
            <span>Great</span>
          </div>
          <button class="submit-button" id="submit-button">Submit Answer</button>
          <div class="completed-message" id="completed-message">
            <i class="check-icon" data-lucide="check"></i>
            <span>Thanks for checking in today!</span>
          </div>
          <div class="results-container" id="results-container">
            <div class="overall-score" id="overall-score">Overall Score: 0/25</div>
            <div class="score-meter">
              <div class="score-progress" id="score-progress"></div>
            </div>
            <div class="score-detail" id="score-detail"></div>
            <div id="responses-list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quests Section -->
    <div id="quests-section" class="section-content" style="display:none;">
      <main class="quests-main">
        <div class="quests-container">
          <div class="quests-header">
            <h2>Quest Tracker</h2>
            <p>Track and complete your personal development goals</p>
          </div>
          <div class="active-quests-container">
            <div class="active-quests-header">
              <h3 class="active-quests-title">Your Active Quests</h3>
              <span class="active-quests-count" id="active-quests-count">0 Active</span>
            </div>
            <div id="active-quests-list">
              <div class="empty-state">
                No active quests. Create a new quest below!
              </div>
            </div>
          </div>
          <div class="quest-form-container">
            <h3>Create New Quest</h3>
            <form id="quest-form">
              <div class="form-group">
                <label for="quest-duration">Quest Duration</label>
                <select id="quest-duration">
                  <option value="Daily">Daily Quest</option>
                  <option value="Weekly">Weekly Quest</option>
                  <option value="Monthly">Monthly Quest</option>
                  <option value="Yearly">Yearly Quest</option>
                </select>
              </div>
              <div class="form-group">
                <label for="quest-goal">Quest Goal</label>
                <input id="quest-goal" type="text" placeholder="What do you want to achieve?" maxlength="100">
                <p class="character-count"><span id="goal-length">0</span>/100 characters</p>
              </div>
              <div class="creation-warning">
                <i data-lucide="alert-triangle"></i>
                <div>
                  <strong>Important:</strong> Quests cannot be deleted once created. 
                  Please make sure you want to track this goal before creating it.
                </div>
              </div>
              <div class="duration-info">
                <p>Creating a <span id="duration-display" class="duration-daily">daily</span> quest</p>
              </div>
              <button type="submit" class="submit-btn">
                <i data-lucide="plus"></i>
                Create Quest
              </button>
            </form>
          </div>
          <div class="achievements-container">
            <div class="achievements-header">
              <h3 class="achievements-title">Quest Achievements</h3>
              <span class="achievements-count" id="achievements-count">0 Completed</span>
            </div>
            <div id="achievements-sections">
              <div class="empty-achievements">
                No achievements yet. Complete some quests to see them here!
              </div>
            </div>
          </div>
          <div id="toast-container" class="toast-container"></div>
        </div>
      </main>
    </div>

    <!-- Chat Section -->
    <div id="chat-section" class="section-content" style="display:none;">
      <div class="chat-container">
        <div class="chat-header">
          <h2 class="chat-title">AI Companion</h2>
        </div>
        <div class="messages-container" id="messages-container">
          <div class="empty-state">
            <div class="empty-state-icon">
              <i data-lucide="message-square"></i>
            </div>
            <p>Start a conversation with your AI companion</p>
          </div>
        </div>
        <div class="input-area">
          <textarea class="message-input" id="message-input" placeholder="Type your message..." rows="1"></textarea>
          <button class="send-button" id="send-button" disabled>
            <i data-lucide="send"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- History Section -->
    <div id="history-section" class="section-content" style="display:none;">
      <div class="history-container">
        <div class="history-section chat-section">
          <h2 class="section-title">
            <i class="fas fa-comments icon"></i>
            Chat History
          </h2>
          <div class="scroll-area" id="chat-history"></div>
        </div>
        <div class="history-section checkin-section">
          <h2 class="section-title">
            <i class="fas fa-calendar-check icon"></i>
            Daily Check-in History
          </h2>
          <div class="scroll-area" id="checkin-history"></div>
        </div>
        <div class="history-section quest-section">
          <h2 class="section-title">
            <i class="fas fa-tasks icon"></i>
            Quest History
          </h2>
          <div class="scroll-area" id="quest-history"></div>
        </div>
      </div>
    </div>

    <!-- Profile Section -->
    <div id="profile-section" class="section-content" style="display:none;">
      <div class="card animate-fade-in">
        <div class="card-header">
          <h1 class="card-title">PROFILE DASHBOARD</h1>
        </div>
        <div class="card-content space-y-6">
          <!-- Avatar and Basic Info -->
          <div class="text-center space-y-4">
            <div class="w-24 h-24 mx-auto bg-secondary rounded-full flex items-center justify-center text-4xl border-4 border-primary/20 avatar-glow">
              ðŸ§™
            </div>
            <div class="space-y-3">
              <div class="flex items-center justify-center space-x-2">
                <h2 class="text-xl font-bold">Kaze Arufa</h2>
                <button class="button button-ghost p-1" id="edit-button">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                  </svg>
                </button>
              </div>
              <div class="max-w-sm mx-auto space-y-2 text-sm" id="profile-info">
                <div class="flex items-center justify-center space-x-2 text-muted-foreground">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <span>Age: <span id="age">25</span></span>
                </div>
                <div class="flex items-center justify-center space-x-2 text-muted-foreground">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                  </svg>
                  <span id="email">kaze.arufa@example.com</span>
                </div>
                <div class="flex items-center justify-center space-x-2 text-muted-foreground">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span id="location">Tokyo, Japan</span>
                </div>
                <div class="flex items-center justify-center space-x-2 text-muted-foreground">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span>Joined <span id="join-date">April 2022</span></span>
                </div>
              </div>
              <div class="max-w-md mx-auto">
                <p class="text-sm bg-secondary/20 rounded-lg p-3 italic" id="bio">
                  "Passionate about personal growth and mindfulness. Love exploring new challenges and helping others achieve their goals."
                </p>
              </div>
            </div>
          </div>
          <!-- Level Progress Visualization -->
          <div class="text-center space-y-3 animate-fade-in delay-100">
            <h3 class="text-lg font-semibold">LEVEL PROGRESS</h3>
            <div class="level-container">
              <svg class="level-circle" viewBox="0 0 100 100">
                <circle class="level-bg" cx="50" cy="50" r="40" />
                <circle class="level-progress" cx="50" cy="50" r="40" 
                        stroke-dasharray="251.2" 
                        stroke-dashoffset="62.8" />
              </svg>
              <div class="level-text">
                <div class="level-number" id="level">12</div>
                <div class="level-label">Level</div>
              </div>
            </div>
            <p class="text-sm text-muted-foreground">
              <span id="current-xp">150</span> / <span id="required-xp">200</span> XP (<span id="progress-percent">75</span>%)
            </p>
          </div>
          <!-- Statistics Grid -->
          <div class="grid grid-cols-2 gap-4 animate-fade-in delay-200">
            <div class="text-center p-3 bg-secondary/20 rounded-lg">
              <div class="flex items-center justify-center space-x-1 mb-1">
                <svg class="w-4 h-4 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4.5 10.5L12 3l7.5 7.5M12 21V3"></path>
                </svg>
                <span class="text-sm font-medium text-muted-foreground">Streak</span>
              </div>
              <p class="text-xl font-bold text-accent" id="streak">886</p>
            </div>
            <div class="text-center p-3 bg-secondary/20 rounded-lg">
              <div class="flex items-center justify-center space-x-1 mb-1">
                <svg class="w-4 h-4 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M16 8l-4 4-4-4"></path>
                </svg>
                <span class="text-sm font-medium text-muted-foreground">Quests</span>
              </div>
              <p class="text-xl font-bold text-primary" id="quests">
                <span id="completed-quests">32</span>/<span id="total-quests">47</span>
              </p>
            </div>
          </div>
          <!-- Badges Section -->
          <div class="space-y-3 animate-fade-in delay-300">
            <div class="flex items-center space-x-2">
              <svg class="w-5 h-5 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2z"></path>
              </svg>
              <h3 class="text-lg font-semibold">BADGES</h3>
            </div>
            <div class="flex flex-wrap gap-2" id="badges-container"></div>
          </div>
          <!-- Avatar Evolution Info -->
          <div class="text-center p-3 bg-accent/10 rounded-lg animate-fade-in delay-300">
            <p class="text-sm text-muted-foreground mb-1">Avatar Stage</p>
            <p class="font-medium text-accent capitalize" id="avatar-stage">Wise</p>
            <p class="text-xs text-muted-foreground mt-1">
              Keep leveling up to evolve your avatar!
            </p>
          </div>
        </div>
      </div>
      <!-- Edit Profile Modal -->
      <div class="modal" id="edit-modal">
        <div class="modal-content">
          <h3 class="modal-title">Edit Profile</h3>
          <form id="profile-form">
            <div class="form-group">
              <label for="edit-name">Name</label>
              <input type="text" id="edit-name" required>
            </div>
            <div class="form-group">
              <label for="edit-age">Age</label>
              <input type="number" id="edit-age" min="1" max="120" required>
            </div>
            <div class="form-group">
              <label for="edit-email">Email</label>
              <input type="email" id="edit-email" required>
            </div>
            <div class="form-group">
              <label for="edit-location">Location</label>
              <input type="text" id="edit-location">
            </div>
            <div class="form-group">
              <label for="edit-bio">Bio</label>
              <textarea id="edit-bio" rows="3" maxlength="200"></textarea>
            </div>
            <div class="modal-actions">
              <button type="button" class="button button-outline" id="cancel-edit">Cancel</button>
              <button type="submit" class="button button-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Navigation Script
    function showSection(sectionId) {
      document.querySelectorAll('.section-content').forEach(section => {
        section.style.display = 'none';
      });
      document.getElementById(`${sectionId}-section`).style.display = 'block';
      const iconColors = {
        'checkin': 'hsl(48 96% 50%)',
        'quests': 'hsl(350, 100%, 70%)',
        'chat': 'hsl(84 81% 44%)',
        'history': 'hsl(210 40% 98%)',
        'profile': 'hsl(218 91% 60%)'
      };
      document.querySelectorAll('.nav-button').forEach(button => {
        button.classList.remove('active');
        const icon = button.querySelector('.icon');
        const btnSection = button.getAttribute('onclick').match(/'([^']+)'/)[1];
        icon.style.color = iconColors[btnSection];
      });
      const activeButton = document.querySelector(`.nav-button[onclick="showSection('${sectionId}')"]`);
      if (activeButton) {
        activeButton.classList.add('active');
        const icon = activeButton.querySelector('.icon');
        icon.style.color = 'hsl(84 81% 44%)';
      }
      if (sectionId === 'quests') {
        initializeQuests();
      } else if (sectionId === 'chat') {
        initializeChat();
      } else if (sectionId === 'history') {
        initializeHistory();
      }
    }

    // Initialize Chat functionality
    function initializeChat() {
      if (window.chatInitialized) return;
      lucide.createIcons();
      const messagesContainer = document.getElementById('messages-container');
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');
      let isLoading = false;
      let messages = [];
      const initialMessage = {
        id: '1',
        text: "Hello! I'm your AI companion. How can I help you today?",
        sender: 'ai',
        timestamp: new Date()
      };
      function formatTime(date) {
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }
      function addMessage(message) {
        const emptyState = messagesContainer.querySelector('.empty-state');
        if (emptyState) {
          messagesContainer.removeChild(emptyState);
        }
        const messageElement = document.createElement('div');
        messageElement.className = `message message-${message.sender}`;
        messageElement.innerHTML = `
          ${message.sender === 'ai' ? `
            <div class="message-avatar ai">
              <i data-lucide="bot"></i>
            </div>
          ` : ''}
          <div class="message-content">
            <div class="message-bubble ${message.sender}">
              ${message.text}
              <div class="message-meta">
                <span class="message-time">${formatTime(message.timestamp)}</span>
              </div>
            </div>
          </div>
          ${message.sender === 'user' ? `
            <div class="message-avatar user">
              <i data-lucide="user"></i>
            </div>
          ` : ''}
        `;
        messagesContainer.appendChild(messageElement);
        scrollToBottom();
        lucide.createIcons();
      }
      function showLoading() {
        const loadingElement = document.createElement('div');
        loadingElement.className = 'message message-ai';
        loadingElement.innerHTML = `
          <div class="message-avatar ai">
            <i data-lucide="bot"></i>
          </div>
          <div class="message-content">
            <div class="loading-dots">
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
            </div>
          </div>
        `;
        messagesContainer.appendChild(loadingElement);
        scrollToBottom();
        lucide.createIcons();
        return loadingElement;
      }
      function scrollToBottom() {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
      function generateAIResponse(userMessage) {
        const responses = [
          "That's wonderful to hear! How can I assist you further?",
          "I understand. Would you like to talk more about that?",
          "I'm sorry to hear that. Remember I'm here to help.",
          "Interesting perspective! Tell me more about your thoughts on this.",
          "Let me think about how best to help with that..."
        ];
        const userText = userMessage.text.toLowerCase();
        let response;
        if (userText.includes('?') || userText.includes('help')) {
          response = "I'd be happy to help with that. Could you provide more details?";
        } else if (userText.includes('sad') || userText.includes('upset')) {
          response = "I'm sorry you're feeling this way. Would it help to talk about what's bothering you?";
        } else if (userText.includes('happy') || userText.includes('excited')) {
          response = "That's fantastic! It's great to hear you're feeling positive!";
        } else {
          response = responses[Math.floor(Math.random() * responses.length)];
        }
        return {
          id: Date.now().toString(),
          text: response,
          sender: 'ai',
          timestamp: new Date()
        };
      }
      async function sendMessage() {
        const text = messageInput.value.trim();
        if (!text || isLoading) return;
        const userMessage = {
          id: Date.now().toString(),
          text: text,
          sender: 'user',
          timestamp: new Date()
        };
        addMessage(userMessage);
        messageInput.value = '';
        messageInput.style.height = 'auto';
        sendButton.disabled = true;
        isLoading = true;
        const loadingElement = showLoading();
        await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));
        const aiMessage = generateAIResponse(userMessage);
        messagesContainer.removeChild(loadingElement);
        addMessage(aiMessage);
        isLoading = false;
      }
      messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
        sendButton.disabled = this.value.trim() === '' || isLoading;
      });
      messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      sendButton.addEventListener('click', sendMessage);
      setTimeout(() => {
        addMessage(initialMessage);
      }, 500);
      window.chatInitialized = true;
    }

    // Initialize History functionality
    function initializeHistory() {
      if (window.historyInitialized) return;
      const mockData = {
        chat: [
          {
            id: 'conv_001',
            title: 'Productivity Strategies',
            content: 'Discussed Pomodoro technique and task batching for better focus...',
            date: '2025-01-10',
            time: '14:30',
            conversationId: 'chat_001'
          },
          {
            id: 'conv_002',
            title: 'Mental Health Check-in',
            content: 'Talked about stress management and work-life balance...',
            date: '2025-01-08',
            time: '09:15',
            conversationId: 'chat_002'
          }
        ],
        checkin: [
          {
            id: 'check_001',
            title: 'Morning Reflection',
            content: 'Set goals for the day and reviewed weekly priorities...',
            date: '2025-01-10',
            time: '08:00'
          },
          {
            id: 'check_002',
            title: 'Evening Review',
            content: 'Reflected on today\'s achievements and areas for improvement...',
            date: '2025-01-09',
            time: '20:45'
          }
        ],
        quest: [
          {
            id: 'quest_001',
            title: 'Meditation Challenge',
            content: 'Completed 15-minute meditation session...',
            date: '2025-01-09',
            time: '07:30'
          },
          {
            id: 'quest_002',
            title: 'Reading Goal',
            content: 'Finished reading 30 pages as part of daily reading quest...',
            date: '2025-01-08',
            time: '21:00'
          }
        ]
      };
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric',
          year: 'numeric'
        });
      }
      function renderHistoryEntries(containerId, entries, type) {
        const container = document.getElementById(containerId);
        if (entries.length === 0) {
          container.innerHTML = '<div class="empty-message">No entries found</div>';
          return;
        }
        container.innerHTML = entries.map(entry => `
          <div class="history-entry ${type}-entry" data-id="${entry.id}" ${type === 'chat' ? `data-conversation="${entry.conversationId}"` : ''}>
            <div class="entry-header">
              <h3 class="entry-title">${entry.title}</h3>
              <span class="entry-time">${entry.time}</span>
            </div>
            <div class="entry-date">${formatDate(entry.date)}</div>
            <div class="entry-content">${entry.content}</div>
          </div>
        `).join('');
        if (type === 'chat') {
          document.querySelectorAll(`#${containerId} .chat-entry`).forEach(entry => {
            entry.addEventListener('click', function() {
              const conversationId = this.getAttribute('data-conversation');
              continueConversation(conversationId);
            });
          });
        }
      }
      function continueConversation(conversationId) {
        console.log(`Continuing conversation ${conversationId}`);
        alert(`Loading conversation ${conversationId}\n(In a real app, this would open the chat interface)`);
      }
      renderHistoryEntries('chat-history', mockData.chat, 'chat');
      renderHistoryEntries('checkin-history', mockData.checkin, 'checkin');
      renderHistoryEntries('quest-history', mockData.quest, 'quest');
      window.historyInitialized = true;
    }

    // Initialize Quests functionality
    function initializeQuests() {
      if (window.questsInitialized) return;
      loadQuests();
      document.getElementById('quest-form').addEventListener('submit', handleQuestSubmit);
      document.getElementById('quest-goal').addEventListener('input', updateGoalLength);
      document.getElementById('quest-duration').addEventListener('change', updateDurationDisplay);
      window.questsInitialized = true;
    }
    let quests = [];
    function loadQuests() {
      const savedQuests = localStorage.getItem('quests');
      if (savedQuests) {
        quests = JSON.parse(savedQuests);
        renderQuests();
        renderAchievements();
      }
    }
    function saveQuests() {
      localStorage.setItem('quests', JSON.stringify(quests));
    }
    function showToast(title, message, type = 'success') {
      const toastContainer = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
      `;
      toastContainer.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 5000);
    }
    function getDurationDetails(duration) {
      const details = {
        icon: 'target',
        colorClass: '',
        iconName: 'target'
      };
      switch (duration.toLowerCase()) {
        case 'daily':
          details.icon = 'clock';
          details.colorClass = 'duration-daily';
          details.iconName = 'clock';
          break;
        case 'weekly':
          details.icon = 'calendar';
          details.colorClass = 'duration-weekly';
          details.iconName = 'calendar';
          break;
        case 'monthly':
          details.icon = 'target';
          details.colorClass = 'duration-monthly';
          details.iconName = 'target';
          break;
        case 'yearly':
          details.icon = 'trophy';
          details.colorClass = 'duration-yearly';
          details.iconName = 'trophy';
          break;
      }
      return details;
    }
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }
    function updateQuestProgress(questId, progress) {
      quests = quests.map(quest => {
        if (quest.id === questId) {
          const newProgress = Math.min(Math.max(progress, 0), 100);
          const completed = newProgress >= 100;
          const updatedQuest = { ...quest, progress: newProgress, completed };
          if (completed && !quest.completedDate) {
            updatedQuest.completedDate = new Date().toISOString();
          }
          if (!completed && quest.completedDate) {
            delete updatedQuest.completedDate;
          }
          return updatedQuest;
        }
        return quest;
      });
      saveQuests();
      renderQuests();
      renderAchievements();
      if (progress >= 100) {
        showToast('Quest Completed!', 'Congratulations on completing your quest!');
        if (typeof confetti === 'function') {
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
          });
        }
      }
    }
    function toggleQuestCompletion(questId) {
      const quest = quests.find(q => q.id === questId);
      if (quest) {
        const newProgress = quest.completed ? 0 : 100;
        updateQuestProgress(questId, newProgress);
      }
    }
    function handleQuestSubmit(e) {
      e.preventDefault();
      const duration = document.getElementById('quest-duration').value;
      const goal = document.getElementById('quest-goal').value.trim();
      if (!goal) {
        showToast('Error', 'Please enter a goal for your quest.', 'error');
        return;
      }
      const confirmed = confirm(`Are you sure you want to create this ${duration.toLowerCase()} quest?\n\n"${goal}"\n\nRemember: Quests cannot be deleted once created.`);
      if (!confirmed) {
        return;
      }
      const newQuest = {
        id: Date.now().toString(),
        duration: duration.toLowerCase(),
        goal,
        progress: 0,
        completed: false,
        createdAt: new Date().toISOString()
      };
      quests = [...quests, newQuest];
      saveQuests();
      document.getElementById('quest-goal').value = '';
      document.getElementById('quest-duration').value = 'Daily';
      updateDurationDisplay();
      updateGoalLength();
      showToast('Quest Created!', `Your ${duration.toLowerCase()} quest has been added.`);
      renderQuests();
    }
    function updateGoalLength() {
      const goalInput = document.getElementById('quest-goal');
      if (goalInput) {
        document.getElementById('goal-length').textContent = goalInput.value.length;
      }
    }
    function updateDurationDisplay() {
      const durationSelect = document.getElementById('quest-duration');
      const durationDisplay = document.getElementById('duration-display');
      if (durationSelect && durationDisplay) {
        const duration = durationSelect.value.toLowerCase();
        durationDisplay.textContent = duration;
        durationDisplay.className = `duration-${duration}`;
      }
    }
    function renderQuests() {
      const activeQuestsList = document.getElementById('active-quests-list');
      const activeQuestsCount = document.getElementById('active-quests-count');
      const activeQuests = quests.filter(quest => !quest.completed);
      activeQuestsCount.textContent = `${activeQuests.length} Active`;
      if (activeQuests.length === 0) {
        activeQuestsList.innerHTML = `
          <div class="empty-state">
            No active quests. Create a new quest below!
          </div>
        `;
        return;
      }
      activeQuestsList.innerHTML = activeQuests.map(quest => {
        const durationDetails = getDurationDetails(quest.duration);
        const formattedDate = formatDate(quest.createdAt);
        return `
          <div class="quest-item">
            <div class="quest-header">
              <div class="quest-type">
                <div class="icon-container ${durationDetails.colorClass}">
                  <i data-lucide="${durationDetails.icon}"></i>
                </div>
                <span class="${durationDetails.colorClass}">
                  ${quest.duration.charAt(0).toUpperCase() + quest.duration.slice(1)}
                </span>
              </div>
              <div class="quest-date">${formattedDate}</div>
            </div>
            <div class="quest-goal">
              ${quest.goal}
            </div>
            <div class="progress-container">
              <div class="progress-info">
                <span>Progress</span>
                <span>${quest.progress}%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill ${durationDetails.colorClass}" 
                     style="width: ${quest.progress}%"></div>
              </div>
            </div>
            <div class="quest-actions">
              <div class="action-buttons">
                <button class="action-btn" 
                        onclick="updateQuestProgress('${quest.id}', ${quest.progress + 25})">
                  +25%
                </button>
                <button class="action-btn" 
                        onclick="updateQuestProgress('${quest.id}', ${quest.progress + 50})">
                  +50%
                </button>
              </div>
              <button class="complete-btn" 
                      onclick="toggleQuestCompletion('${quest.id}')">
                <i data-lucide="check"></i>
                Complete
              </button>
            </div>
          </div>
        `;
      }).join('');
      lucide.createIcons();
    }
    function renderAchievements() {
      const completedQuests = quests.filter(quest => quest.completed);
      const achievementsSections = document.getElementById('achievements-sections');
      const achievementsCount = document.getElementById('achievements-count');
      achievementsCount.textContent = `${completedQuests.length} Completed`;
      if (completedQuests.length === 0) {
        achievementsSections.innerHTML = `
          <div class="empty-achievements">
            No achievements yet. Complete some quests to see them here!
          </div>
        `;
        return;
      }
      const achievementsByDuration = {
        daily: completedQuests.filter(q => q.duration === 'daily'),
        weekly: completedQuests.filter(q => q.duration === 'weekly'),
        monthly: completedQuests.filter(q => q.duration === 'monthly'),
        yearly: completedQuests.filter(q => q.duration === 'yearly')
      };
      let sectionsHTML = '';
      for (const [duration, questsList] of Object.entries(achievementsByDuration)) {
        if (questsList.length > 0) {
          const durationDetails = getDurationDetails(duration);
          sectionsHTML += `
            <div class="achievement-section">
              <h4 class="achievement-section-title">
                <i data-lucide="${durationDetails.iconName}"></i>
                ${duration.charAt(0).toUpperCase() + duration.slice(1)} Quests
                <span class="count-badge">${questsList.length}</span>
              </h4>
              <div class="achievements-grid">
                ${questsList.map(quest => {
                  const formattedDate = formatDate(quest.createdAt);
                  const completedDate = quest.completedDate ? formatDate(quest.completedDate) : 'Recently';
                  return `
                    <div class="achievement-card">
                      <div class="achievement-goal">${quest.goal}</div>
                      <div class="achievement-date">Completed: ${completedDate}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          `;
        }
      }
      achievementsSections.innerHTML = sectionsHTML;
      lucide.createIcons();
    }
    window.updateQuestProgress = updateQuestProgress;
    window.toggleQuestCompletion = toggleQuestCompletion;
    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      showSection('checkin');
    });
  </script>

  <script src="./logic/checkin.js"></script>
  <script src="./logic/quest.js"></script>
  <script src="./logic/chat.js"></script>
  <script src="./logic/history.js"></script>
  <script src="./logic/profile.js"></script>
</body>
</html>